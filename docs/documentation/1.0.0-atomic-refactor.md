# 1.0.0 Atomic Design Refactor

**Date Started:** 2025-11-18
**Goal:** Refactor KonvaLayerEditor.jsx (1650+ lines) into atomic design components

## Current State Analysis

### File Structure
- **Single monolithic component:** `src/pages/KonvaLayerEditor.jsx` (1651 lines)
- **State complexity:** 17+ useState hooks, 8+ useRef hooks
- **Responsibilities:** UI rendering, state management, event handling, business logic, utilities

### Component Sections Identified

#### 1. Constants & Configuration (26-87)
- DEFAULT_CANVAS, BASE_COLORS, RULER_STEP
- TOOLBAR_LAYOUT (toolbar button definitions)
- TOOL_SUBMENUS (dropdown options for tools)
- FILTER_OPTIONS

#### 2. Utility Functions (89-151)
- `clamp()` - value constraining
- `hexToHsb()`, `hsbToHex()` - color conversion
- `randomFromPalette()` - color selection
- `createCanvasDescriptor()` - canvas object factory

#### 3. State Management (153-184)
- Layer/canvas state
- Selection state (layer, object)
- Tool/UI state (active tool, dropdowns, dialogs)
- Transform state (zoom, position, drag)
- Undo/redo refs

#### 4. Event Handlers (200-785)
- Undo/redo logic
- Layer CRUD operations
- Object CRUD operations
- Toolbar interactions
- Transform/drag handlers
- Filter application

#### 5. Render Functions (790-1287)
- `renderObject()` - Konva shape rendering
- `renderColorSection()` - color picker panel
- `renderDraftGrid()` - layout grid overlay
- `renderToolButton()` - toolbar button
- `renderToolOptionsPanel()` - tool dropdown
- `renderInspector()` - properties panel

#### 6. Main JSX (1289-1650)
- Top navigation bar
- Left sidebar (layers/canvas list)
- Center area (toolbar + rulers + stage + artboard)
- Right sidebar (inspector/properties)
- Modal dialogs

## Atomic Design Structure

### ATOMS (Basic building blocks)
Smallest, most reusable components with single responsibility.

- **Button** - base button with variants (primary, secondary, icon, etc.)
- **Input** - text, number, range, color inputs
- **Icon** - already exists at `src/components/icons/Icon.jsx`
- **Separator** - visual divider
- **Label** - text label for inputs

### MOLECULES (Simple component groups)
Combinations of atoms with specific purpose.

- **ToolbarButton** - icon button + optional dropdown trigger
- **LayerItem** - expandable layer with controls (visibility, move, delete)
- **ObjectItem** - object in layer list with controls
- **ColorPicker** - hex input + HSB sliders + spectrum picker
- **PropertyInput** - label + input + optional unit display
- **RangeSlider** - label + range input + number input
- **CanvasHandle** - artboard resize/move handle

### ORGANISMS (Major sections)
Complete UI sections composed of molecules and atoms.

- **Toolbar** - top bar with tool buttons, dropdowns, filter menu
- **LayersSidebar** - left sidebar with canvas/layer management
- **Inspector** - right sidebar with property controls
- **CanvasArea** - main canvas with rulers, stage, artboard
- **TopNav** - navigation bar with app controls

## Target Structure

```
src/
├── components/
│   ├── atoms/
│   │   ├── Button.jsx
│   │   ├── Input.jsx
│   │   ├── Separator.jsx
│   │   └── Label.jsx
│   ├── molecules/
│   │   ├── ToolbarButton.jsx
│   │   ├── LayerItem.jsx
│   │   ├── ObjectItem.jsx
│   │   ├── ColorPicker.jsx
│   │   ├── PropertyInput.jsx
│   │   ├── RangeSlider.jsx
│   │   └── CanvasHandle.jsx
│   ├── organisms/
│   │   ├── Toolbar.jsx
│   │   ├── LayersSidebar.jsx
│   │   ├── Inspector.jsx
│   │   ├── CanvasArea.jsx
│   │   └── TopNav.jsx
│   └── icons/
│       ├── Icon.jsx
│       └── svg/
├── hooks/
│   ├── useUndoRedo.js
│   ├── useKeyboardShortcuts.js
│   └── useCanvasState.js
├── utils/
│   ├── colors.js
│   └── geometry.js
├── constants/
│   └── editor.js
└── pages/
    └── KonvaLayerEditor.jsx (now just composition)
```

## Refactor Phases

### Phase 1: Foundation ✅
- [x] Analyze structure
- [x] Create documentation
- [x] Create folder structure
- [x] Extract constants to `src/constants/editor.js`
- [x] Extract utilities to `src/utils/` (colors.js, geometry.js)

### Phase 2: Atoms ✅
- [x] Button.jsx (with square/regular variants)
- [x] Input.jsx (text, number, range, color)
- [x] Separator.jsx
- [x] Label.jsx

### Phase 3: Molecules ✅
- [x] ToolbarButton.jsx
- [x] LayerItem.jsx
- [x] ObjectItem.jsx
- [x] ColorPicker.jsx
- [x] PropertyInput.jsx
- [x] RangeSlider.jsx
- [x] CanvasHandle.jsx

### Phase 4: Organisms ✅
- [x] TopNav.jsx
- [x] Toolbar.jsx
- [x] LayersSidebar.jsx
- [x] CanvasArea.jsx
- [x] Inspector.jsx

### Phase 5: Integration ✅
- [x] Rename KonvaLayerEditor → KolEditor
- [x] Refactor KolEditor to compose organisms
- [x] Wire up all event handlers and state
- [x] Test all functionality

## Design Principles

1. **Single Responsibility** - Each component does one thing well
2. **Reusability** - Atoms and molecules are generic and reusable
3. **Composition** - Build complex UIs from simple pieces
4. **Separation of Concerns** - UI, state, and logic are separated

## State & Data Flow

### State Owner: KonvaLayerEditor
- Layers/canvas data
- Selected layer/object IDs
- Canvas settings (size, zoom, position)
- Undo/redo stacks

### Organisms receive:
- Data (props from parent)
- Action handlers (callbacks)
- Manage own local UI state

### Data flows down, events flow up
```
KonvaLayerEditor (state)
    ├── TopNav (actions)
    ├── Toolbar (actions)
    ├── LayersSidebar (data + actions)
    ├── CanvasArea (data + actions)
    └── Inspector (data + actions)
```

## Implementation Progress

### Completed (2025-11-18)

**Foundation:**
- ✅ Created atomic design folder structure
- ✅ Extracted constants to `src/constants/editor.js`
- ✅ Extracted utilities to `src/utils/colors.js` and `src/utils/geometry.js`

**Atoms (4 components):**
- ✅ Button - Flexible button with variants (default, primary, ghost, danger) and square/regular modes
- ✅ Input - Multi-type input (text, number, range, color)
- ✅ Separator - Visual divider for toolbars
- ✅ Label - Text label for forms

**Molecules (7 components):**
- ✅ ToolbarButton - Icon button with optional dropdown trigger
- ✅ LayerItem - Expandable layer with visibility/move/delete controls
- ✅ ObjectItem - Object list item with controls
- ✅ ColorPicker - Full color picker with HEX + HSB sliders + spectrum
- ✅ PropertyInput - Label + input combo for properties
- ✅ RangeSlider - Range slider with numeric input
- ✅ CanvasHandle - Artboard resize/move handles (corner, edge, center)

**Organisms (5 components):**
- ✅ TopNav - Navigation bar with canvas size, clear, and load buttons
- ✅ Toolbar - Tool buttons with dropdowns and filter menu
- ✅ LayersSidebar - Full layer/canvas management sidebar
- ✅ Inspector - Property inspector with color picker and controls
- ✅ CanvasArea - Main canvas with rulers, stage, artboard, and handles

**Extras:**
- ✅ ComponentShowcase - Live demo page at `/components` routes (atoms/molecules/organisms)
- ✅ Moved icons to `src/components/icons/` structure

**Integration (2025-11-18):**
- ✅ Renamed KonvaLayerEditor → KolEditor (1654 → 1040 lines)
- ✅ Integrated all 5 organisms into main editor
- ✅ All functionality preserved (undo/redo, keyboard shortcuts, tools, layers, transforms)
- ✅ Dev server running without errors

### Final Metrics

**Code Reduction:**
- **Before:** 1654 lines (monolithic)
- **After:** 1040 lines (organism-composed)
- **Saved:** 614 lines (37% reduction)

**Component Count:**
- **Total Created:** 16 components (4 atoms + 7 molecules + 5 organisms)
- **All components:** < 200 lines with focused responsibility
- **Reusability:** Atoms and molecules are generic and reusable across the app

### Status: ✅ COMPLETE

The atomic design refactor is complete. The editor is now modular, maintainable, and fully functional.
